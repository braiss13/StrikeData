@page "{id:int}"
@using System
@model StrikeData.Pages.MatchData.DetailsModel
@{
    ViewData["Title"] = "Match Details";
}

<h2 class="section-title">Match Details</h2>

@if (Model.Match == null)
{
    <!-- Not found scenario (404 handled by page model); keep a friendly message -->
    <p style="text-align:center; color:#fff;">Match not found.</p>
}
else
{
    <!--
      Summary card:
      - Shows Away vs Home and the final score
      - Displays venue and local datetime (Europe/Madrid)
      - Shows each team's record at the time of the game
    -->
    <div class="match-summary-card">
        @{
            // Convert stored UTC time to Europe/Madrid for readability on the UI.
            var madrid = TimeZoneInfo.FindSystemTimeZoneById("Europe/Madrid");
            var localDate = TimeZoneInfo.ConvertTimeFromUtc(Model.Match.Date, madrid);
        }
        <div class="summary-top">
            <span class="team-name">@Model.Match.AwayTeam?.Name</span>
            <span class="score-big">@Model.Match.AwayRuns - @Model.Match.HomeRuns</span>
            <span class="team-name">@Model.Match.HomeTeam?.Name</span>
        </div>
        <div class="meta-row">
            <span class="venue"><span class="location-icon">üìç</span>@Model.Match.Venue</span>
            <span class="datetime">@localDate.ToString("dd/MM/yyyy HH:mm") (CEST)</span>
        </div>
        <div class="records-row">
            <span class="record"><strong>@Model.Match.AwayTeam?.Name Record</strong>:
                @Model.Match.AwayWins-@Model.Match.AwayLosses (@(Model.Match.AwayPct?.ToString("0.000") ?? "-")%)</span>
            <span class="record"><strong>@Model.Match.HomeTeam?.Name Record</strong>:
                @Model.Match.HomeWins-@Model.Match.HomeLosses (@(Model.Match.HomePct?.ToString("0.000") ?? "-")%)</span>
        </div>
    </div>

    <!-- 
      Per-inning table:
      - Columns highlighted for home/away via CSS utility classes
      - Null-safe display using "-" when a value is missing
    -->
    <table class="table">
        <thead>
            <tr>
                <th>Inning</th>
                <th class="away-stat">Runs </th>
                <th class="away-stat">Hits</th>
                <th class="away-stat">Errors</th>
                <th class="home-stat">Runs</th>
                <th class="home-stat">Hits</th>
                <th class="home-stat">Errors</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var row in Model.InningRows)
            {
                <tr>
                    <td>@row.InningNumber</td>
                    <td class="away-stat">@(row.AwayRuns?.ToString() ?? "-")</td>
                    <td class="away-stat">@(row.AwayHits?.ToString() ?? "-")</td>
                    <td class="away-stat">@(row.AwayErrors?.ToString() ?? "-")</td>
                    <td class="home-stat">@(row.HomeRuns?.ToString() ?? "-")</td>
                    <td class="home-stat">@(row.HomeHits?.ToString() ?? "-")</td>
                    <td class="home-stat">@(row.HomeErrors?.ToString() ?? "-")</td>
                    
                </tr>
            }
            <!-- Totals row: mirrors the summary numbers from Match -->
            <tr class="table-summary">
                <td><strong>Total</strong></td>
                <td class="away-stat">@Model.Match.AwayRuns</td>
                <td class="away-stat">@Model.Match.AwayHits</td>
                <td class="away-stat">@Model.Match.AwayErrors</td>
                <td class="home-stat">@Model.Match.HomeRuns</td>
                <td class="home-stat">@Model.Match.HomeHits</td>
                <td class="home-stat">@Model.Match.HomeErrors</td>
            </tr>
        </tbody>
    </table>

    <!-- Back to index button with extra bottom spacing (see CSS .back-button-container) -->
    <div class="back-button-container">
        <a asp-page="./Index" class="btn-stat-toggle" style="background-color:#2563eb;color:#ffffff;">
            Back to Matches
        </a>
    </div>
}
